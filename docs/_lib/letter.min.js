!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).L=t()}(function(){return function r(o,i,a){function s(e,t){if(!i[e]){if(!o[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(u)return u(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}n=i[e]={exports:{}},o[e][0].call(n.exports,function(t){return s(o[e][1][t]||t)},n,n.exports,r,o,i,a)}return i[e].exports}for(var u="function"==typeof require&&require,t=0;t<a.length;t++)s(a[t]);return s}({1:[function(t,e,n){"use strict";var u=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},r=(Object.defineProperty(n,"__esModule",{value:!0}),n.Engine=void 0,o.prototype.getShape=function(e){var t=this.shapePool.find(function(t){return t.zindex===e});if(void 0===t)throw new Error("cont found shape by zindex:"+e);return t},Object.defineProperty(o.prototype,"shapePoolSize",{get:function(){return this.shapePool.length},enumerable:!1,configurable:!0}),o.prototype.add=function(t){this.shapePool.push(t),t.setEngine(this)},o.prototype.addSome=function(t){var e=this;t.forEach(function(t){return e.add(t)})},o.prototype.remove=function(e){var t=this.shapePool.findIndex(function(t){return t===e});-1!==t&&this.shapePool.splice(t,1)},o.prototype.removeSome=function(t){var e=this;t.forEach(function(t){return e.remove(t)})},o.prototype.render=function(t){var e=this;t&&this.clearAll(),this.shapePool.forEach(function(t){t.visable&&t.renderAfterState(e.ctx)})},o.prototype.clearAll=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},o.prototype.trigger=function(t){var e,n,r=t.p,o=t.action;try{for(var i=u(this.shapePool),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.inRegionAndSetEnterState(r))if("down"===o){if(!s.onMouseDown(t))return}else if("enter"===o){if(!s.onMouseEnter(t))return}else if("leave"===o){if(!s.onMouseLeave(t))return}else if("move"===o){if(s.isEnter)t.action="enter",s.onMouseEnter(t);else if(s.isLeave)t.action="leave",s.onMouseEnter(t);else if(!s.onMouseMove(t))return}else if("out"===o){if(!s.onMouseOut(t))return}else if("over"===o){if(!s.onMouseOver(t))return}else if("up"===o){if(!s.onMouseUp(t))return}else{if("wheel"!==o)throw new Error("cont handler the mouse event "+t.action);if(!s.onMouseWheel(t))return}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},o.prototype.hitTest=function(e){return this.shapePool.map(function(t){return[t.inRegion(e),t]}).filter(function(t){return t[0]}).map(function(t){return t[1].zindex})},o.prototype.removeSelected=function(){this.shapePool.filter(function(t){return t.isSelected()}).forEach(function(t){return t.remove()})},o);function o(t,e){this.ctx=t,this.viewPort=e,this.shapePool=[]}n.Engine=r},{}],2:[function(t,e,n){"use strict";var s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},o=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t};Object.defineProperty(n,"__esModule",{value:!0}),n.putImageSource=n.putRect=n.putCircle=n.putPath=n.putPattern=void 0,n.putPattern=function(e,n){return function(t){t.save(),t.fillStyle=n.pattern,t.fillRect(e[0],e[1],n.width,n.height),t.restore()}},n.putPath=function(n,r){return void 0===r&&(r=!1),function(t){t.beginPath(),t.moveTo.apply(t,o(n[0]));for(var e=1;e<n.length;e++)t.lineTo.apply(t,o(n[e]));r&&t.closePath(),t.stroke()}},n.putCircle=function(o){return function(t){t.beginPath();var e=s(o,2),n=s(e[0],2),r=n[0],n=n[1],e=e[1];t.arc(r,n,e,0,2*Math.PI),t.stroke()}},n.putRect=function(e,n){return function(t){t.beginPath(),(n?t.fillRect:t.strokeRect).apply(t,o(e))}},n.putImageSource=function(i,a){return function(t){var e=s(a||[0,0,t.canvas.width,t.canvas.height],4),n=e[0],r=e[1],o=e[2],e=e[3];t.drawImage(i,n,r,o,e)}}},{}],3:[function(t,e,n){"use strict";var r,o=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(n,e){function r(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?n(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(r,o)}i((u=u.apply(t,a||[])).next())})},i=this&&this.__generator||function(r,o){var i,a,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(n){return function(t){var e=[n,t];if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,a&&(s=2&e[0]?a.return:e[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,e[1])).done)return s;switch(a=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,a=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=o.call(r,u)}catch(t){e=[6,t],a=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},a=(Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=n.Mode=void 0,t("../viewport")),s=t("../utils"),u=t("../planimetry"),c=t("../shapes"),l=t("./shapes"),f=t("./shapes/ModifyAbleRectShape"),h=t("../R"),t=((t=r=n.Mode||(n.Mode={}))[t.Move=0]="Move",t[t.Zoom=1]="Zoom",t[t.SelectShape=2]="SelectShape",t[t.MoveShape=3]="MoveShape",t[t.DrawShape=4]="DrawShape",p.prototype.mount=function(t){var e=this,n=null;if("string"==typeof t){var r=document.getElementById(t);if(!r)throw new Error("cont find mounted dom by id:"+t);n=r}else n=t;n.style.position="relative",n.style.fontSize="0",this.viewport.engine.ctx.canvas.style.position="absolute";var o=this.viewport.appendViewPort,i=(this.viewport.appendViewPort=function(t){t.engine.ctx.canvas.style.position="absolute",n.appendChild(t.engine.ctx.canvas),o(t)},this.viewport.removeAllViewPort);this.viewport.removeAllViewPort=function(){e.viewport.viewports.forEach(function(t){return t.engine.ctx.canvas.remove()}),i()},n.appendChild(this.viewport.engine.ctx.canvas),this.mountRoot=n,this.dropImage()},p.prototype.drawShape=function(t,e){var n=this;if(void 0===e&&(e=!0),!this.mountRoot)throw new Error("editor must mounted to a dom");var r=this.viewport.clone(),o=this.drawCanvas=r.engine.ctx.canvas,i=(o.style.position="absolute",this.mountRoot.appendChild(o),function(){if(n.drawCanvas)return n.drawCanvas.remove(),window.removeEventListener("keydown",a),n.drawShape(t,e)}),a=(t(r,function(t){n.viewport.engine.add(t),n.viewport.engine.clearAll(),n.viewport.engine.render(),i()}),function(t){27==t.keyCode&&i()});window.addEventListener("keydown",a)},p.prototype.twoClickDraw=function(s,u){this.drawShape(function(n,r){var t=n.engine.ctx,e=t.canvas,o=e.offsetTop,i=e.offsetLeft,a=null;t.canvas.addEventListener("mousedown",function(t){var e;null===a?a=[t.offsetX-i,t.offsetY-o]:(e=[a[0],a[1]],t=[t.offsetX-i,t.offsetY-o],s({sPoint:e,ePoint:t,viewport:n,finish:r}))}),t.canvas.addEventListener("mousemove",function(t){var e;null!==a&&(e=[a[0],a[1]],t=[t.offsetX-i,t.offsetY-o],u({sPoint:e,ePoint:t,viewport:n,finish:r}))})})},p.prototype.someClickDraw=function(c,l,f,h){this.drawShape(function(n,r){function e(t){13===t.keyCode&&(h({sPoint:s,ePoint:s,finish:r,viewport:n,path:[]}),window.removeEventListener("keypress",e))}var t=n.engine.ctx,o=t.canvas,i=o.offsetTop,a=o.offsetLeft,s=null,u=[];t.canvas.addEventListener("mousedown",function(t){null===s?(s=[t.offsetX-a,t.offsetY-i],u.push(s),c({sPoint:s,ePoint:s,finish:r,viewport:n,path:u})):(t=[t.offsetX-a,t.offsetY-i],u.push(t),l({sPoint:s,ePoint:t,finish:r,viewport:n,path:u}))}),t.canvas.addEventListener("mousemove",function(t){var e;null!==s&&(t=[t.offsetX-a,t.offsetY-i],e=u.concat([t]),f({sPoint:s,ePoint:t,finish:r,viewport:n,path:e}))}),window.addEventListener("keypress",e)})},p.prototype.drawLine=function(){this.twoClickDraw(function(t){var e=t.sPoint,n=t.ePoint,e=new l.ModifyAbleLineShape([e[0],e[1]],[n[0],n[1]]);t.finish(e)},function(t){var e=t.viewport.engine.ctx,n=t.sPoint,t=t.ePoint;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(t[0],t[1]),e.stroke()})},p.prototype.drawRect=function(){this.twoClickDraw(function(t){var e=t.sPoint,n=t.ePoint,n=new f.ModifyAbleRectShape([e[0],e[1],n[0]-e[0],n[1]-e[1]]);t.finish(n)},function(t){var e=t.viewport.engine.ctx,n=t.sPoint,t=t.ePoint;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath(),e.strokeRect(n[0],n[1],t[0]-n[0],t[1]-n[1])})},p.prototype.drawCircle=function(){this.twoClickDraw(function(t){var e=t.sPoint,n=t.ePoint,r=u.towPointDis(e,n),e=new c.CircleShape([[Math.round((e[0]+n[0])/2),Math.round((e[1]+n[1])/2)],r]);t.finish(e)},function(t){var e=t.viewport.engine.ctx,n=t.sPoint,t=t.ePoint,r=u.towPointDis(n,t);e.clearRect(0,0,e.canvas.width,e.canvas.height),h.putCircle([[Math.round((n[0]+t[0])/2),Math.round((n[1]+t[1])/2)],r])(e)})},p.prototype.drawPloygon=function(){var n=new c.PloygonShape([]);this.someClickDraw(function(t){t.viewport.engine.add(n)},function(t){},function(t){n.setValue(t.path),t.viewport.engine.render(!0)},function(t){var e=n.valueOf();e.pop(),n.setValue(e),t.finish(n)})},p.prototype.selectShape=function(){function t(o){return function(t){var e=i.viewport.engine.ctx.canvas.offsetLeft,n=i.viewport.engine.ctx.canvas.offsetTop,r=t.offsetX,t=t.offsetY;i.viewport.trigger([r-e,t-n],o)}}var i=this;this.viewport.engine.ctx.canvas.addEventListener("mousedown",t("down")),this.viewport.engine.ctx.canvas.addEventListener("mousemove",t("move"))},p.prototype.removeAllSelected=function(){this.viewport.engine.removeSelected(),this.viewport.engine.clearAll(),this.viewport.engine.render()},p.prototype.dropImage=function(){function t(t){return t.preventDefault()}var e=this;document.addEventListener("drop",function(t){t.preventDefault();var n,t=t.dataTransfer;t&&(n=new FileReader,(t=t.files.item(0))&&t.type&&(n.readAsDataURL(t),n.onloadend=function(){return o(e,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return n.result?[4,c.ImageShape.fetchFromUrl(n.result)]:[3,2];case 1:e=t.sent(),this.viewport.engine.add(e),this.viewport.engine.render(!0),t.label=2;case 2:return[2]}})})}))}),document.addEventListener("drag",t),document.addEventListener("dragend",t),document.addEventListener("dragenter",t),document.addEventListener("dragleave",t),document.addEventListener("dragover",t)},p.prototype.cleanDrawCanvas=function(){this.drawCanvas&&(this.drawCanvas.remove(),this.drawCanvas=null),this.viewport.removeAllViewPort()},p);function p(){this.mode=r.Move,this.mountRoot=null,this.drawCanvas=null,this.viewport=new a.ViewPort({width:1024,height:768,ctx:s.createCanvasContext2d(),transformMatrix:u.createTransformMatrix()})}n.Editor=t},{"../R":2,"../planimetry":13,"../shapes":23,"../utils":24,"../viewport":25,"./shapes":8,"./shapes/ModifyAbleRectShape":7}],4:[function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){t[r=void 0===r?n:r]=e[n]}),o=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||e.hasOwnProperty(n)||r(e,t,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(t("./editor"),n)},{"./editor":3}],5:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=(Object.defineProperty(n,"__esModule",{value:!0}),n.ControlPoint=void 0,t("../../planimetry")),u=t("../../shapes"),c=t("../../R"),t=(o=u.Shape,i(l,o),l.prototype.syncValue=function(){var t=a(this.rectPos,4),e=t[0],n=t[1],r=t[2],t=t[3];this.setValue([[e,n],[e+r,n],[e,n+t],[e+r,n+t]])},l.prototype.inRegion=function(t){return s.isInPolygon(this.valueOf(),t)},l.prototype.moveUp=function(t){var e=a(this.rectPos,4),n=e[0],r=e[1],o=e[2],e=e[3];this.rectPos=[n,r-t,o,e],this.syncValue()},l.prototype.moveDown=function(t){var e=a(this.rectPos,4),n=e[0],r=e[1],o=e[2],e=e[3];this.rectPos=[n,r+t,o,e],this.syncValue()},l.prototype.moveLeft=function(t){var e=a(this.rectPos,4),n=e[0],r=e[1],o=e[2],e=e[3];this.rectPos=[n-t,r,o,e],this.syncValue()},l.prototype.moveRight=function(t){var e=a(this.rectPos,4),n=e[0],r=e[1],o=e[2],e=e[3];this.rectPos=[n+t,r-t,o,e],this.syncValue()},l.genControlPoint=function(t){return t.map(function(t,e){t=a(t,2),t=new l([t[0]-2,t[1]-2,4,4]);return t.pathIndex=e,t})},l.createPoint=function(t,e,n){t=new l([t-2,e-2,4,4]);return t.pathIndex=n,t},l.prototype.onMouseEnter=function(t){return!(t.viewport.engine.ctx.canvas.style.cursor="move")},l.prototype.setXY=function(t,e){var n=a(this.rectPos,4),r=n[2],n=n[3];this.rectPos=[t,e,r,n],this.syncValue()},l.prototype.onMouseLeave=function(t){return!(t.viewport.engine.ctx.canvas.style.cursor="default")},l);function l(t,e){void 0===t&&(t=[0,0,0,0]),void 0===e&&(e=!0);var n=o.call(this)||this;return n.rectPos=t,n.filled=e,n.render=function(t){c.putRect(n.rectPos,n.filled)(t)},n.pathIndex=0,n.syncValue(),n}n.ControlPoint=t},{"../../R":2,"../../planimetry":13,"../../shapes":23}],6:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),t=(Object.defineProperty(n,"__esModule",{value:!0}),n.ModifyAbleLineShape=void 0,t("../../shapes")),t=(o=t.LineShape,i(a,o),a);function a(){return null!==o&&o.apply(this,arguments)||this}n.ModifyAbleLineShape=t},{"../../shapes":23}],7:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),t=(Object.defineProperty(n,"__esModule",{value:!0}),n.ModifyAbleRectShape=void 0,t("../../shapes/RectShape")),t=(o=t.RectShape,i(a,o),a);function a(t){return o.call(this,t,!1)||this}n.ModifyAbleRectShape=t},{"../../shapes/RectShape":20}],8:[function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){t[r=void 0===r?n:r]=e[n]}),o=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||e.hasOwnProperty(n)||r(e,t,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(t("./ModifyAbleLineShape"),n)},{"./ModifyAbleLineShape":6}],9:[function(t,e,n){"use strict";function r(){}Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultMouseEvent=void 0,r.prototype.onMouseDown=function(t){return!0},r.prototype.onMouseEnter=function(t){return!0},r.prototype.onMouseLeave=function(t){return!0},r.prototype.onMouseMove=function(t){return!0},r.prototype.onMouseOut=function(t){return!0},r.prototype.onMouseOver=function(t){return!0},r.prototype.onMouseUp=function(t){return!0},r.prototype.onMouseWheel=function(t){return!0},n.DefaultMouseEvent=r},{}],10:[function(t,e,n){"use strict";var y=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},r=(Object.defineProperty(n,"__esModule",{value:!0}),n.MouseEventHandler=void 0,o.prototype.bind=function(){this.viewport.engine.ctx.canvas.addEventListener("mousemove",this.mousemoveHandler)},o.prototype.unbind=function(){this.viewport.engine.ctx.canvas.removeEventListener("mousemove",this.mousemoveHandler)},o);function o(t){var v=this;this.viewport=t,this.beforeViewPortEvent=null,this.beforeHits=[],this.mousemoveHandler=function(t){var e,n,r,o,i=v.viewport.engine.ctx.canvas,a=i.offsetTop,i=i.offsetLeft,s=v.viewport.transformEvent("move",[t.offsetX-i,t.offsetY-a]),u=(u=v.viewport.engine.hitTest(s.p)).slice(0,1);try{for(var c=y(v.beforeHits),l=c.next();!l.done;l=c.next()){var f=l.value;try{var h=v.viewport.engine.getShape(f);u.includes(f)||h.onMouseLeave(s)}catch(t){}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var p=y(u),d=p.next();!d.done;d=p.next()){f=d.value;try{h=v.viewport.engine.getShape(f);v.beforeHits.includes(f)?h.onMouseMove(s):h.onMouseEnter(s)}catch(t){}}}catch(t){r={error:t}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}v.beforeHits=u,v.beforeViewPortEvent=s}}n.MouseEventHandler=r},{}],11:[function(t,e,n){"use strict";var D=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},k=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(D(arguments[e]));return t},T=(Object.defineProperty(n,"__esModule",{value:!0}),n.getPointsFromImageData=n.binarization=n.grayscale=n.minExternalReact=void 0,t("./utils"));n.minExternalReact=function(t,e){void 0===e&&(e=[0,0,0,0]);for(var n,r,o,i,a,s,u,c,l=(d=D(T.colorChannel(t),4))[0],f=d[1],h=d[2],p=d[3],d=t.width,t=t.height,v=T.rowIndex(d,t),y=T.colIndex(d,t),w=!1,m=0,g=0;g<v.length;g++){var S=v[g];try{n=void 0;for(var _=k(S),P=_.next();!P.done;P=_.next())if(l[j=P.value]!==e[0]||f[j]!==e[1]||h[j]!==e[2]||p[j]!==e[3]){m=g,w=!0;break}}catch(t){n={error:t}}finally{try{P&&!P.done&&(r=_.return)&&r.call(_)}finally{if(n)throw n.error}}if(w)break}for(var w=!1,b=0,x=0;x<y.length;x++){var M=y[x];try{o=void 0;for(var O=k(M),E=O.next();!E.done;E=O.next())if(l[j=E.value]!==e[0]||f[j]!==e[1]||h[j]!==e[2]||p[j]!==e[3]){b=x,w=!0;break}}catch(t){o={error:t}}finally{try{E&&!E.done&&(i=O.return)&&i.call(O)}finally{if(o)throw o.error}}if(w)break}w=!1;for(var A=0,g=v.length-1;0<g;g--){S=v[g];try{a=void 0;for(var C=k(S),R=C.next();!R.done;R=C.next())if(l[j=R.value]!==e[0]||f[j]!==e[1]||h[j]!==e[2]||p[j]!==e[3]){A=g-m,w=!0;break}}catch(t){a={error:t}}finally{try{R&&!R.done&&(s=C.return)&&s.call(C)}finally{if(a)throw a.error}}if(w)break}w=!1;for(var L=0,x=y.length-1;0<x;x--){M=y[x];try{u=void 0;for(var j,V=k(M),I=V.next();!I.done;I=V.next())if(l[j=I.value]!==e[0]||f[j]!==e[1]||h[j]!==e[2]||p[j]!==e[3]){L=x-b,w=!0;break}}catch(t){u={error:t}}finally{try{I&&!I.done&&(c=V.return)&&c.call(V)}finally{if(u)throw u.error}}if(w)break}return[b,m,L,A]},n.grayscale=function(t){var e=T.addArrays.apply(void 0,r(T.colorChannel(t).slice(0,3))).map(function(t){return t/3});return T.mergeColorChannel([e,e,e,e.map(function(){return 225})],t.width)},n.binarization=function(t){var e=T.addArrays.apply(void 0,r(T.colorChannel(t).slice(0,3))).map(function(t){return t/3}).reduce(function(t,e){return t+e}),n=Math.floor(e/t.width/t.height),e=T.addArrays.apply(void 0,r(T.colorChannel(t).slice(0,3))).map(function(t){return n<t?225:0});return T.mergeColorChannel([e,e,e,e.map(function(){return 225})],t.width)},n.getPointsFromImageData=function(t,e){void 0===e&&(e=[0,0,0,0]);for(var n=T.zip(T.colorChannel(t)),r=[],o=0;o<n.length;o++)n[o][0]===e[0]&&n[o][1]===e[1]&&n[o][2]===e[2]&&n[o][3]===e[3]||r.push(o);return r}},{"./utils":24}],12:[function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){t[r=void 0===r?n:r]=e[n]}),o=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||e.hasOwnProperty(n)||r(e,t,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(t("./editor"),n),o(t("./viewport"),n),o(t("./utils"),n),o(t("./R"),n),o(t("./image"),n),o(t("./planimetry"),n),o(t("./shapes"),n)},{"./R":2,"./editor":4,"./image":11,"./planimetry":13,"./shapes":23,"./utils":24,"./viewport":25}],13:[function(t,e,n){"use strict";var m=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},p=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(m(arguments[e]));return t},o=(Object.defineProperty(n,"__esModule",{value:!0}),n.twoPathNotEqPoints=n.pathEq=n.pointEq=n.multiplyTransformMatrix=n.scale=n.translate=n.transformPath=n.transform=n.createTransformMatrix=n.copyPath=n.isInRects=n.isInRect=n.getPointsRect=n.isConvex=n.isInConvexPolygon=n.isInTriangle=n.isIpsilaterals=n.isInPolygon=n.calcIntersectionWithDomain=n.calcIntersection=n.isParallel=n.isIpsilateral=n.linefn=n.towPointDis=n.towPointLine=n.isInLineDomain=n.addDomain=void 0,t("./utils"));function i(t,e){return{line:t,domain:e}}function a(t,e){e=m(e,1)[0];if(!t.domain)return!0;var t=t.domain,n=t.lower,t=t.upper;return void 0===n&&void 0===t||(void 0!==n&&void 0===t&&n<=e||(void 0===n&&void 0!==t&&e<=t||void 0!==n&&void 0!==t&&n<=e&&e<=t))}function s(t,e){return[e[1]-t[1],t[0]-e[0],e[0]*t[1]-t[0]*e[1]]}function f(e){return function(t){return e[0]*t[0]+e[1]*t[1]+e[2]}}function u(t,e,n){t=f(t);return 0<=t(e)*t(n)}function c(t,e){var t=m(t,2),n=t[0],t=t[1],e=m(e,2);return n/t==e[0]/e[1]}function l(t,e){var n=m(t,3),r=n[0],o=n[1],n=n[2],i=m(t,3),a=i[0],s=i[1],i=i[2];if(c(t,e))throw new Error("Tow lines are parallel");t=s*r-o*a;return[(o*i-s*n)/t,(r*i-n*a)/-t]}function h(t){for(var e,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];var i=f(t),a=r[0];try{for(var s=p(r),u=s.next();!u.done;u=s.next()){var c=u.value;if(0!==i(c)){a=c;break}}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}for(var l=0;l<r.length;l++)if(i(a)*i(r[l])<0)return!1;return!0}function d(e,n){return[[0,1,2],[0,2,1],[2,1,0]].map(function(t){return u(s(e[t[0]],e[t[1]]),e[t[2]],n)}).every(o.eqT)}function v(t,e){var t=m(t,4),n=t[0],r=t[1],o=t[2],t=t[3],e=m(e,2),i=e[0],e=e[1];return n<=i&&i<=n+o&&r<=e&&e<=r+t}function y(){return[1,0,0,0,1,0,0,0,1]}function w(t,e){var e=m(e,2),n=e[0],e=e[1];return[t[0]*n+t[1]*e+t[2],t[3]*n+t[4]*e+t[5]]}function g(t,e){var t=m(t,9),n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],s=t[5],u=t[6],c=t[7],t=t[8],e=m(e,9),l=e[0],f=e[1],h=e[2],p=e[3],d=e[4],v=e[5],y=e[6],w=e[7],e=e[8];return[n*l+r*p+o*y,n*f+r*d+o*w,n*h+r*v+o*e,i*l+a*p+s*y,i*f+a*d+s*w,i*h+a*v+s*e,u*l+c*p+t*y,u*f+c*d+t*w,u*h+c*v+t*e]}function S(t,e){return t[0]===e[0]&&t[1]===e[1]}n.addDomain=i,n.isInLineDomain=a,n.towPointLine=s,n.towPointDis=function(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))},n.linefn=f,n.isIpsilateral=u,n.isParallel=c,n.calcIntersection=l,n.calcIntersectionWithDomain=function(t,e){t=Array.isArray(t)?i(t):t,e=Array.isArray(e)?i(e):e;try{var n=l(t.line,e.line);return a(t,n)&&a(e,n)?n:null}catch(t){return null}},n.isInPolygon=function(t,e){for(var n=!1,r=(e=m(e,2))[0],o=e[1],i=0,a=t.length,s=a-1;i<a;s=i,i++){var u=t[i][0],c=t[i][1],l=t[s][0],f=t[s][1];if(u===r&&c===o||l===r&&f===o)return!0;if(c<o&&o<=f||o<=c&&f<o){l=u+(o-c)*(l-u)/(f-c);if(l===r)return!0;r<l&&(n=!n)}}return n},n.isIpsilaterals=h,n.isInTriangle=d,n.isInConvexPolygon=function(t,e){for(var n=t[0],r=1;r<t.length-1;r++)if(d([n,t[r],t[r+1]],e))return!0;return!1},n.isConvex=function(e){return 3===e.length||o.range(e.length).map(function(t){return[t,(t+1)%e.length]}).map(function(t){return s(e[t[0]],e[t[1]])}).every(function(t){return h.apply(void 0,r([t],e))})},n.getPointsRect=function(t){var e,n;if(0===t.length)return[0,0,0,0];var r=t[0][0],o=t[0][1],i=t[0][0],a=t[0][1];try{for(var s=p(t),u=s.next();!u.done;u=s.next()){var c=u.value,l=m(c,2),f=l[0],h=l[1];i<f&&(i=f),f<r&&(r=f),a<h&&(a=h),h<o&&(o=h)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return[r,o,Math.abs(r-i),Math.abs(o-a)]},n.isInRect=v,n.isInRects=function(t,e){return t.findIndex(function(t){return v(t,e)})},n.copyPath=function(t){var e=[];return t.forEach(function(t){return e.push([t[0],t[1]])}),e},n.createTransformMatrix=y,n.transform=w,n.transformPath=function(e,t){return t.map(function(t){return w(e,t)})},n.translate=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var o=y();return o[2]+=e=void 0===e?0:e,o[5]+=n,o[8]+=r,g(t,o)},n.scale=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var o=y();return o[0]+=e=void 0===e?0:e,o[4]+=n,o[8]+=r,g(t,o)},n.multiplyTransformMatrix=g,n.pointEq=S,n.pathEq=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++){var r=m([t[n],e[n]],2);if(!S(r[0],r[1]))return!1}return!0},n.twoPathNotEqPoints=function(t,e){if(t.length!==e.length)throw new Error("path length is not equal");for(var n=[],r=0;r<t.length;r++){var o=m([t[r],e[r]],2);S(o[0],o[1])||n.push(r)}return n}},{"./utils":24}],14:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=(Object.defineProperty(n,"__esModule",{value:!0}),n.CircleShape=void 0,t("../R")),u=t("../planimetry"),t=t("./ModifyAbleShape"),t=(o=t.ModifyAbleShape,i(c,o),c.prototype.moveUp=function(t){this.circle=[[this.circle[0][0],this.circle[0][1]-t],this.circle[1]],this.syncValue()},c.prototype.moveDown=function(t){this.circle=[[this.circle[0][0],this.circle[0][1]+t],this.circle[1]],this.syncValue()},c.prototype.moveLeft=function(t){this.circle=[[this.circle[0][0]-t,this.circle[0][1]],this.circle[1]],this.syncValue()},c.prototype.moveRight=function(t){this.circle=[[this.circle[0][0]+t,this.circle[0][1]],this.circle[1]],this.syncValue()},c.prototype.setValue=function(t){o.prototype.setValue.call(this,t);var t=a(t,2),e=t[0],t=t[1],n=a(e,2),r=n[0],n=n[1],e=u.towPointDis(e,t);this.circle=[[r,n],e]},c.prototype.syncValue=function(){var t=a(this.circle,2),e=a(t[0],2),n=e[0],e=e[1],t=t[1];o.prototype.setValue.call(this,[[n,e],[n+t,e]])},c.prototype.inRegion=function(t){return u.towPointDis(t,this.circle[0])<=this.circle[1]},c);function c(t){var e=o.call(this)||this;return e.circle=t,e.isFilled=!1,e.render=function(t){s.putCircle(e.circle)(t),e.isFilled&&t.fill()},e.syncValue(),e}n.CircleShape=t},{"../R":2,"../planimetry":13,"./ModifyAbleShape":17}],15:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=(Object.defineProperty(n,"__esModule",{value:!0}),n.ImageShape=void 0,t("../R")),u=t("../planimetry"),t=t("./ModifyAbleShape"),t=(o=t.ModifyAbleShape,i(c,o),c.prototype.moveUp=function(t){this.pos=[this.pos[0],this.pos[1]-t,this.pos[2],this.pos[3]],this.syncValue()},c.prototype.moveDown=function(t){this.pos=[this.pos[0],this.pos[1]+t,this.pos[2],this.pos[3]],this.syncValue()},c.prototype.moveLeft=function(t){this.pos=[this.pos[0]-t,this.pos[1],this.pos[2],this.pos[3]],this.syncValue()},c.prototype.moveRight=function(t){this.pos=[this.pos[0]+t,this.pos[1],this.pos[2],this.pos[3]],this.syncValue()},c.prototype.syncValue=function(){var t=a(this.pos,4),e=t[0],n=t[1],r=t[2],t=t[3];o.prototype.setValue.call(this,[[e,n],[e+r,n],[e,n+t],[e+r,n+t]])},c.prototype.setValue=function(t){o.prototype.setValue.call(this,t);var t=a(t,4),e=t[0],t=t[3],e=a(e,2),n=e[0],e=e[1],r=t[0]-n,t=t[1]-e;this.pos=[n,e,r,t]},c.prototype.inRegion=function(t){return u.isInRect(this.pos,t)},c.fetchFromUrl=function(r){return new Promise(function(t,e){var n=new Image;n.src=r,n.onload=function(){return t(new c(n,[0,0,n.width,n.height]))},n.onerror=function(t){return e(t)}})},c.prototype.fetchFromUrl=function(r){var o=this;return new Promise(function(t,e){var n=new Image;n.src=r,n.onload=function(){return t(o)},n.onerror=function(t){return e(t)}})},c);function c(t,e){var n=o.call(this)||this;return n.image=t,n.pos=e,n.render=function(t){s.putImageSource(n.image,n.pos)(t)},n.syncValue(),n}n.ImageShape=t},{"../R":2,"../planimetry":13,"./ModifyAbleShape":17}],16:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=(Object.defineProperty(n,"__esModule",{value:!0}),n.LineShape=void 0,t("../R")),s=t("../planimetry"),t=t("./ModifyAbleShape"),t=(o=t.ModifyAbleShape,i(u,o),u.prototype.moveUp=function(t){this.start=[this.start[0],this.start[1]-t],this.end=[this.end[0],this.end[1]-t]},u.prototype.moveDown=function(t){this.start=[this.start[0],this.start[1]+t],this.end=[this.end[0],this.end[1]+t]},u.prototype.moveLeft=function(t){this.start=[this.start[0]-t,this.start[1]],this.end=[this.end[0]-t,this.end[1]]},u.prototype.moveRight=function(t){this.start=[this.start[0]+t,this.start[1]],this.end=[this.end[0]+t,this.end[1]]},Object.defineProperty(u.prototype,"start",{get:function(){return this.valueOf()[0]},set:function(t){var e=this.valueOf();e[0]=t,this.setValue(e)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"end",{get:function(){return this.valueOf()[1]},set:function(t){var e=this.valueOf();e[1]=t,this.setValue(e)},enumerable:!1,configurable:!0}),u.inRegion=function(t,e,n){var r=s.towPointDis(n,t),n=s.towPointDis(n,e),t=s.towPointDis(t,e);return Math.round(r+n)===Math.round(t)},u.prototype.inRegion=function(t){return u.inRegion(this.start,this.end,t)},u);function u(t,e){var n=o.call(this)||this;return n.render=function(t){a.putPath([n.start,n.end])(t)},n.setValue([t,e]),n}n.LineShape=t},{"../R":2,"../planimetry":13,"./ModifyAbleShape":17}],17:[function(t,e,n){"use strict";var r,o,i,a=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),p=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},d=(Object.defineProperty(n,"__esModule",{value:!0}),n.ModifyAbleShape=n.ModifyKind=void 0,t("../editor/shapes/ControlPoint")),u=t("../planimetry"),s=t("./SelectAbleShape"),c=t("./Shape"),l=t("../R"),t=((t=o=n.ModifyKind||(n.ModifyKind={}))[t.MoveAndModifyControlPoint=0]="MoveAndModifyControlPoint",t[t.Zoom=1]="Zoom",i=s.SelectAbleShape,a(f,i),f.prototype.onUnSelected=function(){this.controlPoints.forEach(function(t){return t.remove()}),this.controlPoints=[]},f.prototype.modifyValue=function(){function t(t){var e=(n=l.engine.ctx.canvas).offsetTop,n=n.offsetLeft,t=(n=p([t.offsetX-n,t.offsetY-e],2))[0],e=n[1],n=l.transformEvent("move",[t,e]);0!==(n=l.engine.hitTest(n.p)).length&&(f=[t,e],(t=n.map(function(t){return l.engine.getShape(t)}).filter(function(t){return t instanceof d.ControlPoint})).length&&(h=t[0]))}function e(t){var e,n,r,o,i,a,s,u;null!==f&&(e=(i=l.engine.ctx.canvas).offsetTop,i=i.offsetLeft,t=(i=p([t.offsetX-i,t.offsetY-e],2))[0],e=i[1],f=(null===h?(i=p([f[0]-t,f[1]-e],2),n=i[0],r=i[1],i=c.valueOf().map(function(t){return[t[0]-n,t[1]-r]}),c.setValue(i),c.controlPoints.forEach(function(t){return t.remove()}),c.controlPoints=d.ControlPoint.genControlPoint(c.valueOf()),l.engine.addSome(c.controlPoints)):(o=(i=p([f[0]-t,f[1]-e],2))[0],i=i[1],a=(s=p(h.rectPos,2))[0],s=s[1],h.setXY(a-o,s-i),(u=c.valueOf())[h.pathIndex]=[a-o,s-i],c.setValue(u)),l.engine.render(!0),[t,e]))}function n(){h=f=null}var c=this,l=this.engine.viewPort,f=(this.controlPoints=d.ControlPoint.genControlPoint(this.valueOf()),l.engine.addSome(this.controlPoints),null),h=null;l.engine.ctx.canvas.addEventListener("mousedown",t),l.engine.ctx.canvas.addEventListener("mousemove",e),l.engine.ctx.canvas.addEventListener("mouseup",n),l.engine.ctx.canvas.addEventListener("mouseleave",n),this.cleanEvent=function(){n(),l.engine.ctx.canvas.removeEventListener("mousedown",t),l.engine.ctx.canvas.removeEventListener("mousemove",e),l.engine.ctx.canvas.removeEventListener("mouseup",n),l.engine.ctx.canvas.removeEventListener("mouseleave",n)},window.addEventListener("keydown",this.ZKeyDown)},f.prototype.modifyTransform=function(){var t=new c.Shape,e=(this.controlPoints.forEach(function(t){return t.remove()}),p(u.getPointsRect(this.valueOf()),4)),n=e[0],r=e[1],o=e[2],e=e[3],i=d.ControlPoint.createPoint(n+o,r-10,0),a=d.ControlPoint.createPoint(n-10,r+e,0),s=d.ControlPoint.createPoint(n+o+10,r+e+10,0);t.setValue([[n+o,r-10],[n-10,r-10],[n-10,r+e]]),t.render=function(t){return l.putPath(this.valueOf(),!1)(t)},this.engine.addSome([t,i,a,s]),this.engine.render(!0),console.log("modifyTransform")},f.prototype.onSelected=function(t,e){this.kind===o.MoveAndModifyControlPoint?this.modifyValue():this.kind===o.Zoom&&this.modifyTransform()},f.prototype.unSelect=function(){this.controlPoints.forEach(function(t){return t.remove()}),this.controlPoints=[],this.drawState={strokeStyle:"#000"},i.prototype.unSelect.call(this),window.removeEventListener("keydown",this.ZKeyDown)},f);function f(){var e=null!==i&&i.apply(this,arguments)||this;return e.controlPoints=[],e.kind=o.MoveAndModifyControlPoint,e.cleanEvent=function(){},e.ZKeyDown=function(t){90===t.keyCode&&(e.cleanEvent(),e.engine.render(!0),e.kind===o.MoveAndModifyControlPoint?(e.kind=o.Zoom,e.modifyTransform()):(e.kind=o.MoveAndModifyControlPoint,e.modifyValue()))},e}n.ModifyAbleShape=t},{"../R":2,"../editor/shapes/ControlPoint":5,"../planimetry":13,"./SelectAbleShape":21,"./Shape":22}],18:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=(Object.defineProperty(n,"__esModule",{value:!0}),n.PathShape=void 0,t("../R")),s=t("../utils"),u=t("./LineShape"),t=t("./ModifyAbleShape"),t=(o=t.ModifyAbleShape,i(c,o),c.prototype.moveUp=function(e){this.paths=this.paths.map(function(t){return[t[0],t[1]+e]})},c.prototype.moveDown=function(e){this.paths=this.paths.map(function(t){return[t[0],t[1]-e]})},c.prototype.moveLeft=function(e){this.paths=this.paths.map(function(t){return[t[0]+e,t[1]]})},c.prototype.moveRight=function(e){this.paths=this.paths.map(function(t){return[t[0]-e,t[1]]})},Object.defineProperty(c.prototype,"paths",{get:function(){return this.valueOf()},set:function(t){this.setValue(t)},enumerable:!1,configurable:!0}),c.prototype.inRegion=function(e){return s.sliding(2,this.paths).some(function(t){return u.LineShape.inRegion(t[0],t[1],e)})},c);function c(t){var e=o.call(this)||this;return e.render=function(t){a.putPath(e.paths)(t)},e.setValue(t),e}n.PathShape=t},{"../R":2,"../utils":24,"./LineShape":16,"./ModifyAbleShape":17}],19:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=(Object.defineProperty(n,"__esModule",{value:!0}),n.PloygonShape=void 0,t("./PathShape")),s=t("../R"),u=t("../planimetry"),t=(o=a.PathShape,i(c,o),c.prototype.inRegion=function(t){return u.isInPolygon(this.paths,t)},c);function c(){var e=null!==o&&o.apply(this,arguments)||this;return e.isFilled=!1,e.render=function(t){s.putPath(e.paths,!0)(t),e.isFilled&&t.fill()},e}n.PloygonShape=t},{"../R":2,"../planimetry":13,"./PathShape":18}],20:[function(t,e,n){"use strict";var r,i,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=(Object.defineProperty(n,"__esModule",{value:!0}),n.RectShape=void 0,t("../R")),t=t("./ModifyAbleShape"),t=(i=t.ModifyAbleShape,o(u,i),u);function u(t,e){void 0===e&&(e=!0);var n=i.call(this)||this,e=(n.filled=e,n.render=function(t){s.putPath(n.valueOf(),!0)(t)},a(t,4)),t=e[0],r=e[1],o=e[2],e=e[3];return i.prototype.setValue.call(n,[[t,r],[t+o,r],[t+o,r+e],[t,r+e]]),n}n.RectShape=t},{"../R":2,"./ModifyAbleShape":17}],21:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},t=(Object.defineProperty(n,"__esModule",{value:!0}),n.SelectAbleShape=void 0,t("./Shape")),t=(o=t.Shape,i(s,o),s.prototype.onMouseDown=function(r){var o,i=this;return this.isSelected()||(this.select(),this.drawState={strokeStyle:"red"},(o=r.viewport.clone()).engine.ctx.canvas.addEventListener("mousedown",function(t){var e=r.viewport.engine.ctx.canvas,n=e.offsetTop,e=e.offsetLeft,e=a([t.offsetX-e,t.offsetY-n],2),t=e[0],n=e[1],e=o.transformEvent("move",[t,n]);0===o.engine.hitTest(e.p).length&&(i.drawState={strokeStyle:"#000",fillStyle:"#000"},r.viewport.engine.add(i),r.viewport.engine.render(!0),o.engine.ctx.canvas.remove(),i.unSelect())}),this.remove(),r.viewport.engine.clearAll(),r.viewport.engine.render(),o.engine.add(this),this.onSelected(o,r),o.engine.render(),r.viewport.appendViewPort(o),r.viewport.engine.render(!0)),!1},s.prototype.unSelect=function(){this.drawState={strokeStyle:"#000"},this.onUnSelected(),o.prototype.unSelect.call(this)},s);function s(){return null!==o&&o.apply(this,arguments)||this}n.SelectAbleShape=t},{"./Shape":22}],22:[function(t,e,n){"use strict";var r,o,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},a=(Object.defineProperty(n,"__esModule",{value:!0}),n.Shape=void 0,t("../planimetry")),t=t("../handler/DefaultMouseEvent"),t=(o=t.DefaultMouseEvent,i(c,o),c.prototype.isSelected=function(){return this.selected},c.prototype.select=function(){this.selected=!0},c.prototype.unSelect=function(){this.selected=!1},c.prototype.setEngine=function(t){this.engine=t},c.prototype.remove=function(){this.engine&&this.engine.remove(this)},c.prototype.inRegion=function(t){return a.isInPolygon(this.valueOf(),t)},c.prototype.inRegionAndSetEnterState=function(t){t=this.inRegion(t);return t?this.isEnter||(this.isEnter=!0,this.isLeave=!1):this.isEnter&&(this.isEnter=!1,this.isLeave=!0),t},c.prototype.moveUp=function(e){this.setValue(this.valueOf().map(function(t){return[t[0],t[1]+e]}))},c.prototype.moveDown=function(e){this.setValue(this.valueOf().map(function(t){return[t[0],t[1]-e]}))},c.prototype.moveLeft=function(e){this.setValue(this.valueOf().map(function(t){return[t[0]+e,t[1]]}))},c.prototype.moveRight=function(e){this.setValue(this.valueOf().map(function(t){return[t[0]-e,t[1]]}))},c.prototype.setValue=function(t){this.value=t},c.prototype.valueOf=function(){return a.copyPath(this.value)},c.autoIndex=0,c);function c(){var s=o.call(this)||this;return s.isEnter=!1,s.isLeave=!1,s.visable=!0,s.engine=null,s.drawState=null,s.selected=!1,s.transformMatrix=a.createTransformMatrix(),s.renderAfterState=function(t){var e=u(s.transformMatrix,6),n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],e=e[5];t.setTransform(n,i,r,a,o,e),s.drawState?(t.save(),s.drawState.direction&&(t.direction=s.drawState.direction),s.drawState.font&&(t.font=s.drawState.font),s.drawState.textAlign&&(t.textAlign=s.drawState.textAlign),s.drawState.textBaseline&&(t.textBaseline=s.drawState.textBaseline),s.drawState.fillStyle&&(t.fillStyle=s.drawState.fillStyle),s.drawState.strokeStyle&&(t.strokeStyle=s.drawState.strokeStyle),s.drawState.filter&&(t.filter=s.drawState.filter),s.drawState.globalAlpha&&(t.globalAlpha=s.drawState.globalAlpha),s.drawState.globalCompositeOperation&&(t.globalCompositeOperation=s.drawState.globalCompositeOperation),s.drawState.imageSmoothingEnabled&&(t.imageSmoothingEnabled=s.drawState.imageSmoothingEnabled),s.drawState.imageSmoothingQuality&&(t.imageSmoothingQuality=s.drawState.imageSmoothingQuality),s.drawState.lineCap&&(t.lineCap=s.drawState.lineCap),s.drawState.lineDashOffset&&(t.lineDashOffset=s.drawState.lineDashOffset),s.drawState.lineJoin&&(t.lineJoin=s.drawState.lineJoin),s.drawState.lineWidth&&(t.lineWidth=s.drawState.lineWidth),s.drawState.miterLimit&&(t.miterLimit=s.drawState.miterLimit),s.drawState.shadowBlur&&(t.shadowBlur=s.drawState.shadowBlur),s.drawState.shadowColor&&(t.shadowColor=s.drawState.shadowColor),s.drawState.shadowOffsetX&&(t.shadowOffsetX=s.drawState.shadowOffsetX),s.drawState.shadowOffsetY&&(t.shadowOffsetY=s.drawState.shadowOffsetY),s.render(t),t.restore()):s.render(t)},s.render=function(){},s.value=[],s.zindex=c.autoIndex++,s}n.Shape=t},{"../handler/DefaultMouseEvent":9,"../planimetry":13}],23:[function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){t[r=void 0===r?n:r]=e[n]}),o=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||e.hasOwnProperty(n)||r(e,t,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(t("./Shape"),n),o(t("./PloygonShape"),n),o(t("./PathShape"),n),o(t("./LineShape"),n),o(t("./ImageShape"),n),o(t("./CircleShape"),n),o(t("./RectShape"),n)},{"./CircleShape":14,"./ImageShape":15,"./LineShape":16,"./PathShape":18,"./PloygonShape":19,"./RectShape":20,"./Shape":22}],24:[function(t,e,r){"use strict";var c=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function n(t,e){for(var n=[],r=0;r<t.length;r++)n.push(t[r]+e[r]);return n}function o(t,e){for(var n=[],r=[],o=0;o<e.length;o++)r.push(e[o]),(o+1)%t==0&&(n.push(r),r=[]);return 0!==r.length&&n.push(r),n}function i(t,e,n){return t+e*n}function a(e){return function(t){return e===t}}Object.defineProperty(r,"__esModule",{value:!0}),r.zip=r.createCanvasContext2d=r.eqT=r.isEq=r.countArray=r.colIndex=r.rowIndex=r.index2pos=r.pos2index=r.mergeColorChannel=r.sliding=r.chunk=r.copyArrayElements=r.addArrays=r.addArray=r.colorChannel=r.map=r.crange=r.range=r.cacheLast=void 0,r.cacheLast=function(e){var n=null,r=[];return function(t){return n&&n===t?r:r=e(n=t)}},r.range=function(t){if(t===1/0)throw new Error("too large");for(var e=[],n=0;n<t;n++)e.push(n);return e},r.crange=r.cacheLast(r.range),r.map=function(t,e){return e.map(t)},r.colorChannel=function(t){var e=t.data;return[r.map(function(t){return e[4*t]},r.crange(e.length/4)),r.map(function(t){return e[4*t+1]},r.crange(e.length/4)),r.map(function(t){return e[4*t+2]},r.crange(e.length/4)),r.map(function(t){return e[4*t+3]},r.crange(e.length/4))]},r.addArray=n,r.addArrays=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce(n)},r.copyArrayElements=function(t,e){var n,r,o=[];try{for(var i=c(e),a=i.next();!a.done;a=i.next())for(var s=a.value,u=0;u<t;u++)o.push(s)}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o},r.chunk=o,r.sliding=function(t,e){if(t<=0)return[e];for(var n=[],r=0;r<e.length;r+=t){if(!(r+t<e.length)){n.push(e.slice(r,e.length-1));break}n.push(e.slice(r,r+t))}return n},r.mergeColorChannel=function(t,e){for(var n=(t=u(t,4))[0],r=t[1],o=t[2],i=t[3],a=[],s=0;s<n.length;s++)[n[s],r[s],o[s],i[s]].forEach(function(t){return a.push(Math.floor(t))});return new ImageData(new Uint8ClampedArray(a),e,n.length/e)},r.pos2index=i,r.index2pos=function(t,e){return[t%e,Math.floor(t/e)]},r.rowIndex=function(t,e){return o(t,r.crange(t*e))},r.colIndex=function(n,t){return r.map(function(e){return r.map(function(t){return e+t*n},r.crange(t))},r.crange(n))},r.countArray=function(t){var e,n,r=new Map;try{for(var o=c(t),i=o.next();!i.done;i=o.next()){var a=i.value;r.has(a)?r.set(a,r.get(a)+1):r.set(a,1)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r},r.isEq=a,r.eqT=a(!0),r.createCanvasContext2d=function(t,e){void 0===t&&(t=100),void 0===e&&(e=100);var n=document.createElement("canvas"),t=(n.width=t,n.height=e,n.getContext("2d"));if(null===t)throw new Error("cont create canvas ctx !");return t},r.zip=function(t){for(var e=[],n=0;n<t[0].length;n++){for(var r=[],o=0;o<t.length;o++)r.push(t[o][n]);e.push(r)}return e}},{}],25:[function(t,e,n){"use strict";var s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},r=(Object.defineProperty(n,"__esModule",{value:!0}),n.ViewPort=void 0,t("./planimetry")),u=t("./handler/MouseEventHandler"),c=t("./Engine"),o=t("./utils");function i(t){var e=this,t=(this.mouseEventHandler=new u.MouseEventHandler(this),this.viewports=[],this.appendViewPort=function(t){e.viewports.push(t)},this.removeAllViewPort=function(){e.viewports=[]},this.ctx=t.ctx,this.width=t.width,this.height=t.height,this.transformMatrix=t.transformMatrix,this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,s(this.transformMatrix,6)),n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],t=t[5];this.ctx.setTransform(n,i,r,a,o,t),this.engine=new c.Engine(this.ctx,this),this.mouseEventHandler.bind()}i.prototype.trigger=function(t,e){e=this.transformEvent(e,t);this.engine.trigger(e)},i.prototype.clone=function(){return new i({width:this.width,height:this.height,transformMatrix:this.transformMatrix,ctx:o.createCanvasContext2d()})},i.prototype.cloneAndCopyAShape=function(t){var e=this.clone();return e.engine.add(t),e},i.prototype.cloneAndCopyAShapeByIndex=function(t){t=this.engine.getShape(t);return this.cloneAndCopyAShape(t)},i.prototype.transformEvent=function(t,e){return{p:r.transform(this.transformMatrix,e),action:t,viewport:this}},n.ViewPort=i},{"./Engine":1,"./handler/MouseEventHandler":10,"./planimetry":13,"./utils":24}]},{},[12])(12)});
//# sourceMappingURL=letter.min.js.map
