!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).L=t()}}(function(){return function i(a,s,u){function c(e,t){if(!s[e]){if(!a[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(f)return f(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=s[e]={exports:{}};a[e][0].call(o.exports,function(t){return c(a[e][1][t]||t)},o,o.exports,i,a,s,u)}return s[e].exports}for(var f="function"==typeof require&&require,t=0;t<u.length;t++)c(u[t]);return c}({1:[function(t,e,n){"use strict";var u=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var r=(o.prototype.getShape=function(e){var t=this.shapePool.find(function(t){return t.zindex===e});if(void 0===t)throw new Error("cont found shape by zindex:"+e);return t},Object.defineProperty(o.prototype,"shapePoolSize",{get:function(){return this.shapePool.length},enumerable:!0,configurable:!0}),o.prototype.add=function(t){this.shapePool.push(t),t.setEngine(this)},o.prototype.addSome=function(t){var e=this;t.forEach(function(t){return e.add(t)})},o.prototype.remove=function(e){var t=this.shapePool.findIndex(function(t){return t===e});-1!==t&&this.shapePool.splice(t,1)},o.prototype.removeSome=function(t){var e=this;t.forEach(function(t){return e.remove(t)})},o.prototype.render=function(t){var e=this;t&&this.clearAll(),this.shapePool.forEach(function(t){t.visable&&t.renderAfterState(e.ctx)})},o.prototype.clearAll=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},o.prototype.trigger=function(t){var e,n,r=t.p,o=t.action;try{for(var i=u(this.shapePool),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.inRegionAndSetEnterState(r)){if("down"===o){if(s.onMouseDown(t))continue;return}if("enter"===o){if(s.onMouseEnter(t))continue;return}if("leave"===o){if(s.onMouseLeave(t))continue;return}if("move"!==o){if("out"===o){if(s.onMouseOut(t))continue;return}if("over"===o){if(s.onMouseOver(t))continue;return}if("up"===o){if(s.onMouseUp(t))continue;return}if("wheel"!==o)throw new Error("cont handler the mouse event "+t.action);if(s.onMouseWheel(t))continue;return}if(s.isEnter)t.action="enter",s.onMouseEnter(t);else{if(!s.isLeave){if(s.onMouseMove(t))continue;return}t.action="leave",s.onMouseEnter(t)}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},o.prototype.hitTest=function(e){return this.shapePool.map(function(t){return[t.inRegion(e),t]}).filter(function(t){return t[0]}).map(function(t){return t[1].zindex})},o.prototype.removeSelected=function(){this.shapePool.filter(function(t){return t.isSelected()}).forEach(function(t){return t.remove()})},o);function o(t,e){this.ctx=t,this.viewPort=e,this.shapePool=[]}n.Engine=r},{}],2:[function(t,e,n){"use strict";var u=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},o=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t};Object.defineProperty(n,"__esModule",{value:!0}),n.putPattern=function(e,n){return function(t){t.save(),t.fillStyle=n.pattern,t.fillRect(e[0],e[1],n.width,n.height),t.restore()}},n.putPath=function(n,r){return void 0===r&&(r=!1),function(t){t.beginPath(),t.moveTo.apply(t,o(n[0]));for(var e=1;e<n.length;e++)t.lineTo.apply(t,o(n[e]));r&&t.closePath(),t.stroke()}},n.putCircle=function(a){return function(t){t.beginPath();var e=u(a,2),n=u(e[0],2),r=n[0],o=n[1],i=e[1];t.arc(r,o,i,0,2*Math.PI),t.stroke()}},n.putRect=function(e,n){return function(t){t.beginPath(),n?t.fillRect.apply(t,o(e)):t.strokeRect.apply(t,o(e))}},n.putImageSource=function(a,s){return function(t){var e=u(s||[0,0,t.canvas.width,t.canvas.height],4),n=e[0],r=e[1],o=e[2],i=e[3];t.drawImage(a,n,r,o,i)}}},{}],3:[function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(e,n){function r(t){try{i(u.next(t))}catch(t){n(t)}}function o(t){try{i(u.throw(t))}catch(t){n(t)}}function i(t){t.done?e(t.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(t.value).then(r,o)}i((u=u.apply(t,a||[])).next())})},a=this&&this.__generator||function(n,r){var o,i,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(n,"__esModule",{value:!0});var r,o,s=t("../viewport"),u=t("../utils"),c=t("../planimetry"),f=t("../shapes"),l=t("./shapes"),h=t("./shapes/ModifyAbleRectShape"),p=t("../R");(o=r=n.Mode||(n.Mode={}))[o.Move=0]="Move",o[o.Zoom=1]="Zoom",o[o.SelectShape=2]="SelectShape",o[o.MoveShape=3]="MoveShape",o[o.DrawShape=4]="DrawShape";var v=(d.prototype.mount=function(t){var e=this,n=null;if("string"==typeof t){var r=document.getElementById(t);if(!r)throw new Error("cont find mounted dom by id:"+t);n=r}else n=t;n.style.position="relative",n.style.fontSize="0",this.viewport.engine.ctx.canvas.style.position="absolute";var o=this.viewport.appendViewPort;this.viewport.appendViewPort=function(t){t.engine.ctx.canvas.style.position="absolute",n.appendChild(t.engine.ctx.canvas),o(t)};var i=this.viewport.removeAllViewPort;this.viewport.removeAllViewPort=function(){e.viewport.viewports.forEach(function(t){return t.engine.ctx.canvas.remove()}),i()},n.appendChild(this.viewport.engine.ctx.canvas),this.mountRoot=n,this.dropImage()},d.prototype.drawShape=function(t,e){var n=this;if(void 0===e&&(e=!0),!this.mountRoot)throw new Error("editor must mounted to a dom");var r=this.viewport.clone(),o=this.drawCanvas=r.engine.ctx.canvas;function i(){if(n.drawCanvas)return n.drawCanvas.remove(),window.removeEventListener("keydown",a),n.drawShape(t,e)}o.style.position="absolute",this.mountRoot.appendChild(o),t(r,function(t){n.viewport.engine.add(t),n.viewport.engine.clearAll(),n.viewport.engine.render(),i()});var a=function(t){27==t.keyCode&&i()};window.addEventListener("keydown",a)},d.prototype.twoClickDraw=function(u,c){this.drawShape(function(r,o){var t=r.engine.ctx,e=t.canvas,i=e.offsetTop,a=e.offsetLeft,s=null;t.canvas.addEventListener("mousedown",function(t){if(null===s)s=[t.offsetX-a,t.offsetY-i];else{var e=[s[0],s[1]],n=[t.offsetX-a,t.offsetY-i];u({sPoint:e,ePoint:n,viewport:r,finish:o})}}),t.canvas.addEventListener("mousemove",function(t){if(null!==s){var e=[s[0],s[1]],n=[t.offsetX-a,t.offsetY-i];c({sPoint:e,ePoint:n,viewport:r,finish:o})}})})},d.prototype.someClickDraw=function(c,f,l,h){this.drawShape(function(r,o){var t=r.engine.ctx,e=t.canvas,i=e.offsetTop,a=e.offsetLeft,s=null,u=[],n=function(t){13===t.keyCode&&(h({sPoint:s,ePoint:s,finish:o,viewport:r,path:[]}),window.removeEventListener("keypress",n))};t.canvas.addEventListener("mousedown",function(t){if(null===s)s=[t.offsetX-a,t.offsetY-i],u.push(s),c({sPoint:s,ePoint:s,finish:o,viewport:r,path:u});else{var e=[t.offsetX-a,t.offsetY-i];u.push(e),f({sPoint:s,ePoint:e,finish:o,viewport:r,path:u})}}),t.canvas.addEventListener("mousemove",function(t){if(null!==s){var e=[t.offsetX-a,t.offsetY-i],n=u.concat([e]);l({sPoint:s,ePoint:e,finish:o,viewport:r,path:n})}}),window.addEventListener("keypress",n)})},d.prototype.drawLine=function(){this.twoClickDraw(function(t){var e=t.sPoint,n=t.ePoint,r=new l.ModifyAbleLineShape([e[0],e[1]],[n[0],n[1]]);t.finish(r)},function(t){var e=t.viewport.engine.ctx,n=t.sPoint,r=t.ePoint;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(r[0],r[1]),e.stroke()})},d.prototype.drawRect=function(){this.twoClickDraw(function(t){var e=t.sPoint,n=t.ePoint,r=new h.ModifyAbleRectShape([e[0],e[1],n[0]-e[0],n[1]-e[1]]);t.finish(r)},function(t){var e=t.viewport.engine.ctx,n=t.sPoint,r=t.ePoint;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath(),e.strokeRect(n[0],n[1],r[0]-n[0],r[1]-n[1])})},d.prototype.drawCircle=function(){this.twoClickDraw(function(t){var e=t.sPoint,n=t.ePoint,r=c.towPointDis(e,n),o=new f.CircleShape([[Math.round((e[0]+n[0])/2),Math.round((e[1]+n[1])/2)],r]);t.finish(o)},function(t){var e=t.viewport.engine.ctx,n=t.sPoint,r=t.ePoint,o=c.towPointDis(n,r);e.clearRect(0,0,e.canvas.width,e.canvas.height),p.putCircle([[Math.round((n[0]+r[0])/2),Math.round((n[1]+r[1])/2)],o])(e)})},d.prototype.drawPloygon=function(){var n=new f.PloygonShape([]);this.someClickDraw(function(t){t.viewport.engine.add(n)},function(t){},function(t){n.setValue(t.path),t.viewport.engine.render(!0)},function(t){var e=n.valueOf();e.pop(),n.setValue(e),t.finish(n)})},d.prototype.selectShape=function(){function t(i){return function(t){var e=a.viewport.engine.ctx.canvas.offsetLeft,n=a.viewport.engine.ctx.canvas.offsetTop,r=t.offsetX,o=t.offsetY;a.viewport.trigger([r-e,o-n],i)}}var a=this;this.viewport.engine.ctx.canvas.addEventListener("mousedown",t("down")),this.viewport.engine.ctx.canvas.addEventListener("mousemove",t("move"))},d.prototype.removeAllSelected=function(){this.viewport.engine.removeSelected(),this.viewport.engine.clearAll(),this.viewport.engine.render()},d.prototype.dropImage=function(){function t(t){return t.preventDefault()}var o=this;document.addEventListener("drop",function(t){t.preventDefault();var e=t.dataTransfer;if(e){var n=new FileReader,r=e.files.item(0);r&&r.type&&(n.readAsDataURL(r),n.onloadend=function(){return i(o,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return n.result?[4,f.ImageShape.fetchFromUrl(n.result)]:[3,2];case 1:e=t.sent(),this.viewport.engine.add(e),this.viewport.engine.render(!0),t.label=2;case 2:return[2]}})})})}}),document.addEventListener("drag",t),document.addEventListener("dragend",t),document.addEventListener("dragenter",t),document.addEventListener("dragleave",t),document.addEventListener("dragover",t)},d.prototype.cleanDrawCanvas=function(){this.drawCanvas&&(this.drawCanvas.remove(),this.drawCanvas=null),this.viewport.removeAllViewPort()},d);function d(){this.mode=r.Move,this.mountRoot=null,this.drawCanvas=null,this.viewport=new s.ViewPort({width:1024,height:768,ctx:u.createCanvasContext2d(),transformMatrix:c.createTransformMatrix()})}n.Editor=v},{"../R":2,"../planimetry":13,"../shapes":23,"../utils":24,"../viewport":25,"./shapes":8,"./shapes/ModifyAbleRectShape":7}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(t("./editor"))},{"./editor":3}],5:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};Object.defineProperty(n,"__esModule",{value:!0});var i,s=t("../../planimetry"),u=t("../../shapes"),c=t("../../R"),f=(i=u.Shape,o(l,i),l.prototype.syncValue=function(){var t=a(this.rectPos,4),e=t[0],n=t[1],r=t[2],o=t[3];this.setValue([[e,n],[e+r,n],[e,n+o],[e+r,n+o]])},l.prototype.inRegion=function(t){return s.isInPolygon(this.valueOf(),t)},l.prototype.moveUp=function(t){var e=a(this.rectPos,4),n=e[0],r=e[1],o=e[2],i=e[3];this.rectPos=[n,r-t,o,i],this.syncValue()},l.prototype.moveDown=function(t){var e=a(this.rectPos,4),n=e[0],r=e[1],o=e[2],i=e[3];this.rectPos=[n,r+t,o,i],this.syncValue()},l.prototype.moveLeft=function(t){var e=a(this.rectPos,4),n=e[0],r=e[1],o=e[2],i=e[3];this.rectPos=[n-t,r,o,i],this.syncValue()},l.prototype.moveRight=function(t){var e=a(this.rectPos,4),n=e[0],r=e[1],o=e[2],i=e[3];this.rectPos=[n+t,r-t,o,i],this.syncValue()},l.genControlPoint=function(t){return t.map(function(t,e){var n=a(t,2),r=new l([n[0]-2,n[1]-2,4,4]);return r.pathIndex=e,r})},l.createPoint=function(t,e,n){var r=new l([t-2,e-2,4,4]);return r.pathIndex=n,r},l.prototype.onMouseEnter=function(t){return!(t.viewport.engine.ctx.canvas.style.cursor="move")},l.prototype.setXY=function(t,e){var n=a(this.rectPos,4),r=n[2],o=n[3];this.rectPos=[t,e,r,o],this.syncValue()},l.prototype.onMouseLeave=function(t){return!(t.viewport.engine.ctx.canvas.style.cursor="default")},l);function l(t,e){void 0===t&&(t=[0,0,0,0]),void 0===e&&(e=!0);var n=i.call(this)||this;return n.rectPos=t,n.filled=e,n.render=function(t){c.putRect(n.rectPos,n.filled)(t)},n.pathIndex=0,n.syncValue(),n}n.ControlPoint=f},{"../../R":2,"../../planimetry":13,"../../shapes":23}],6:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i,a=t("../../shapes"),s=(i=a.LineShape,o(u,i),u);function u(){return null!==i&&i.apply(this,arguments)||this}n.ModifyAbleLineShape=s},{"../../shapes":23}],7:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i,a=t("../../shapes/RectShape"),s=(i=a.RectShape,o(u,i),u);function u(t){return i.call(this,t,!1)||this}n.ModifyAbleRectShape=s},{"../../shapes/RectShape":20}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(t("./ModifyAbleLineShape"))},{"./ModifyAbleLineShape":6}],9:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=(o.prototype.onMouseDown=function(t){return!0},o.prototype.onMouseEnter=function(t){return!0},o.prototype.onMouseLeave=function(t){return!0},o.prototype.onMouseMove=function(t){return!0},o.prototype.onMouseOut=function(t){return!0},o.prototype.onMouseOver=function(t){return!0},o.prototype.onMouseUp=function(t){return!0},o.prototype.onMouseWheel=function(t){return!0},o);function o(){}n.DefaultMouseEvent=r},{}],10:[function(t,e,n){"use strict";var w=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var r=(o.prototype.bind=function(){this.viewport.engine.ctx.canvas.addEventListener("mousemove",this.mousemoveHandler)},o.prototype.unbind=function(){this.viewport.engine.ctx.canvas.removeEventListener("mousemove",this.mousemoveHandler)},o);function o(t){var y=this;this.viewport=t,this.beforeViewPortEvent=null,this.beforeHits=[],this.mousemoveHandler=function(t){var e,n,r,o,i=y.viewport.engine.ctx.canvas,a=i.offsetTop,s=i.offsetLeft,u=y.viewport.transformEvent("move",[t.offsetX-s,t.offsetY-a]),c=y.viewport.engine.hitTest(u.p);c=c.slice(0,1);try{for(var f=w(y.beforeHits),l=f.next();!l.done;l=f.next()){var h=l.value;try{var p=y.viewport.engine.getShape(h);c.includes(h)||p.onMouseLeave(u)}catch(t){}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=f.return)&&n.call(f)}finally{if(e)throw e.error}}try{for(var v=w(c),d=v.next();!d.done;d=v.next()){h=d.value;try{p=y.viewport.engine.getShape(h);y.beforeHits.includes(h)?p.onMouseMove(u):p.onMouseEnter(u)}catch(t){}}}catch(t){r={error:t}}finally{try{d&&!d.done&&(o=v.return)&&o.call(v)}finally{if(r)throw r.error}}y.beforeHits=c,y.beforeViewPortEvent=u}}n.MouseEventHandler=r},{}],11:[function(t,e,n){"use strict";var T=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},U=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(T(arguments[e]));return t};Object.defineProperty(n,"__esModule",{value:!0});var X=t("./utils");n.minExternalReact=function(t,e){var n,r,o,i,a,s,u,c;void 0===e&&(e=[0,0,0,0]);for(var f=T(X.colorChannel(t),4),l=f[0],h=f[1],p=f[2],v=f[3],d=t.width,y=t.height,w=X.rowIndex(d,y),m=X.colIndex(d,y),g=!1,S=0,_=0;_<w.length;_++){var b=w[_];try{for(var P=(n=void 0,U(b)),x=P.next();!x.done;x=P.next()){if(l[I=x.value]!==e[0]||h[I]!==e[1]||p[I]!==e[2]||v[I]!==e[3]){S=_,g=!0;break}}}catch(t){n={error:t}}finally{try{x&&!x.done&&(r=P.return)&&r.call(P)}finally{if(n)throw n.error}}if(g)break}g=!1;for(var M=0,O=0;O<m.length;O++){var E=m[O];try{for(var A=(o=void 0,U(E)),C=A.next();!C.done;C=A.next()){if(l[I=C.value]!==e[0]||h[I]!==e[1]||p[I]!==e[2]||v[I]!==e[3]){M=O,g=!0;break}}}catch(t){o={error:t}}finally{try{C&&!C.done&&(i=A.return)&&i.call(A)}finally{if(o)throw o.error}}if(g)break}g=!1;var R=0;for(_=w.length-1;0<_;_--){b=w[_];try{for(var L=(a=void 0,U(b)),j=L.next();!j.done;j=L.next()){if(l[I=j.value]!==e[0]||h[I]!==e[1]||p[I]!==e[2]||v[I]!==e[3]){R=_-S,g=!0;break}}}catch(t){a={error:t}}finally{try{j&&!j.done&&(s=L.return)&&s.call(L)}finally{if(a)throw a.error}}if(g)break}g=!1;var V=0;for(O=m.length-1;0<O;O--){E=m[O];try{for(var k=(u=void 0,U(E)),D=k.next();!D.done;D=k.next()){var I;if(l[I=D.value]!==e[0]||h[I]!==e[1]||p[I]!==e[2]||v[I]!==e[3]){V=O-M,g=!0;break}}}catch(t){u={error:t}}finally{try{D&&!D.done&&(c=k.return)&&c.call(k)}finally{if(u)throw u.error}}if(g)break}return[M,S,V,R]},n.grayscale=function(t){var e=X.addArrays.apply(void 0,o(X.colorChannel(t).slice(0,3))).map(function(t){return t/3});return X.mergeColorChannel([e,e,e,e.map(function(){return 225})],t.width)},n.binarization=function(t){var e=X.addArrays.apply(void 0,o(X.colorChannel(t).slice(0,3))).map(function(t){return t/3}).reduce(function(t,e){return t+e}),n=Math.floor(e/t.width/t.height),r=X.addArrays.apply(void 0,o(X.colorChannel(t).slice(0,3))).map(function(t){return n<t?225:0});return X.mergeColorChannel([r,r,r,r.map(function(){return 225})],t.width)},n.getPointsFromImageData=function(t,e){void 0===e&&(e=[0,0,0,0]);for(var n=X.zip(X.colorChannel(t)),r=[],o=0;o<n.length;o++)n[o][0]===e[0]&&n[o][1]===e[1]&&n[o][2]===e[2]&&n[o][3]===e[3]||r.push(o);return r}},{"./utils":24}],12:[function(t,e,n){"use strict";function r(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0}),r(t("./editor")),r(t("./viewport")),r(t("./utils")),r(t("./R")),r(t("./image")),r(t("./planimetry")),r(t("./shapes"))},{"./R":2,"./editor":4,"./image":11,"./planimetry":13,"./shapes":23,"./utils":24,"./viewport":25}],13:[function(t,e,n){"use strict";var p=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},b=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},r=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(b(arguments[e]));return t};Object.defineProperty(n,"__esModule",{value:!0});var o=t("./utils");function i(t,e){return[e[1]-t[1],t[0]-e[0],e[0]*t[1]-t[0]*e[1]]}function l(e){return function(t){return e[0]*t[0]+e[1]*t[1]+e[2]}}function a(t,e,n){var r=l(t);return 0<=r(e)*r(n)}function s(t){for(var e,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];var i=l(t),a=r[0];try{for(var s=p(r),u=s.next();!u.done;u=s.next()){var c=u.value;if(0!==i(c)){a=c;break}}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}for(var f=0;f<r.length;f++)if(i(a)*i(r[f])<0)return!1;return!0}function u(e,n){return[[0,1,2],[0,2,1],[2,1,0]].map(function(t){return a(i(e[t[0]],e[t[1]]),e[t[2]],n)}).every(o.eqT)}function c(t,e){var n=b(t,4),r=n[0],o=n[1],i=n[2],a=n[3],s=b(e,2),u=s[0],c=s[1];return r<=u&&u<=r+i&&o<=c&&c<=o+a}function f(){return[1,0,0,0,1,0,0,0,1]}function h(t,e){var n=b(e,2),r=n[0],o=n[1];return[t[0]*r+t[1]*o+t[2],t[3]*r+t[4]*o+t[5]]}function v(t,e){var n=b(t,9),r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],u=n[5],c=n[6],f=n[7],l=n[8],h=b(e,9),p=h[0],v=h[1],d=h[2],y=h[3],w=h[4],m=h[5],g=h[6],S=h[7],_=h[8];return[r*p+o*y+i*g,r*v+o*w+i*S,r*d+o*m+i*_,a*p+s*y+u*g,a*v+s*w+u*S,a*d+s*m+u*_,c*p+f*y+l*g,c*v+f*w+l*S,c*d+f*m+l*_]}function d(t,e){return t[0]===e[0]&&t[1]===e[1]}n.towPointLine=i,n.towPointDis=function(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))},n.linefn=l,n.isIpsilateral=a,n.isIpsilaterals=s,n.isInTriangle=u,n.isInPolygon=function(t,e){for(var n=t[0],r=1;r<t.length-1;r++){if(u([n,t[r],t[r+1]],e))return!0}return!1},n.isConvex=function(e){return 3===e.length||o.range(e.length).map(function(t){return[t,(t+1)%e.length]}).map(function(t){return i(e[t[0]],e[t[1]])}).every(function(t){return s.apply(void 0,r([t],e))})},n.getPointsRect=function(t){var e,n;if(0===t.length)return[0,0,0,0];var r=t[0][0],o=t[0][1],i=t[0][0],a=t[0][1];try{for(var s=p(t),u=s.next();!u.done;u=s.next()){var c=u.value,f=b(c,2),l=f[0],h=f[1];i<l&&(i=l),l<r&&(r=l),a<h&&(a=h),h<o&&(o=h)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return[r,o,Math.abs(r-i),Math.abs(o-a)]},n.isInRect=c,n.isInRects=function(t,e){return t.findIndex(function(t){return c(t,e)})},n.copyPath=function(t){var e=[];return t.forEach(function(t){return e.push([t[0],t[1]])}),e},n.createTransformMatrix=f,n.transform=h,n.transformPath=function(e,t){return t.map(function(t){return h(e,t)})},n.translate=function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0);var o=[1,0,0,0,1,0,0,0,1];return o[2]+=e,o[5]+=n,o[8]+=r,v(t,o)},n.scale=function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0);var o=[1,0,0,0,1,0,0,0,1];return o[0]+=e,o[4]+=n,o[8]+=r,v(t,o)},n.multiplyTransformMatrix=v,n.pointEq=d,n.pathEq=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++){var r=b([t[n],e[n]],2);if(!d(r[0],r[1]))return!1}return!0},n.twoPathNotEqPoints=function(t,e){if(t.length!==e.length)throw new Error("path length is not equal");for(var n=[],r=0;r<t.length;r++){var o=b([t[r],e[r]],2);d(o[0],o[1])||n.push(r)}return n}},{"./utils":24}],14:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};Object.defineProperty(n,"__esModule",{value:!0});var c,i=t("../R"),f=t("../planimetry"),a=t("./ModifyAbleShape"),s=(c=a.ModifyAbleShape,o(l,c),l.prototype.moveUp=function(t){this.circle=[[this.circle[0][0],this.circle[0][1]-t],this.circle[1]],this.syncValue()},l.prototype.moveDown=function(t){this.circle=[[this.circle[0][0],this.circle[0][1]+t],this.circle[1]],this.syncValue()},l.prototype.moveLeft=function(t){this.circle=[[this.circle[0][0]-t,this.circle[0][1]],this.circle[1]],this.syncValue()},l.prototype.moveRight=function(t){this.circle=[[this.circle[0][0]+t,this.circle[0][1]],this.circle[1]],this.syncValue()},l.prototype.setValue=function(t){c.prototype.setValue.call(this,t);var e=u(t,2),n=e[0],r=e[1],o=u(n,2),i=o[0],a=o[1],s=f.towPointDis(n,r);this.circle=[[i,a],s]},l.prototype.syncValue=function(){var t=u(this.circle,2),e=u(t[0],2),n=e[0],r=e[1],o=t[1];c.prototype.setValue.call(this,[[n,r],[n+o,r]])},l.prototype.inRegion=function(t){return f.towPointDis(t,this.circle[0])<=this.circle[1]},l);function l(t){var e=c.call(this)||this;return e.circle=t,e.isFilled=!1,e.render=function(t){i.putCircle(e.circle)(t),e.isFilled&&t.fill()},e.syncValue(),e}n.CircleShape=s},{"../R":2,"../planimetry":13,"./ModifyAbleShape":17}],15:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};Object.defineProperty(n,"__esModule",{value:!0});var f,i=t("../R"),a=t("../planimetry"),s=t("./ModifyAbleShape"),u=(f=s.ModifyAbleShape,o(l,f),l.prototype.moveUp=function(t){this.pos=[this.pos[0],this.pos[1]-t,this.pos[2],this.pos[3]],this.syncValue()},l.prototype.moveDown=function(t){this.pos=[this.pos[0],this.pos[1]+t,this.pos[2],this.pos[3]],this.syncValue()},l.prototype.moveLeft=function(t){this.pos=[this.pos[0]-t,this.pos[1],this.pos[2],this.pos[3]],this.syncValue()},l.prototype.moveRight=function(t){this.pos=[this.pos[0]+t,this.pos[1],this.pos[2],this.pos[3]],this.syncValue()},l.prototype.syncValue=function(){var t=c(this.pos,4),e=t[0],n=t[1],r=t[2],o=t[3];f.prototype.setValue.call(this,[[e,n],[e+r,n],[e,n+o],[e+r,n+o]])},l.prototype.setValue=function(t){f.prototype.setValue.call(this,t);var e=c(t,4),n=e[0],r=e[3],o=c(n,2),i=o[0],a=o[1],s=r[0]-i,u=r[1]-a;this.pos=[i,a,s,u]},l.prototype.inRegion=function(t){return a.isInRect(this.pos,t)},l.fetchFromUrl=function(r){return new Promise(function(t,e){var n=new Image;n.src=r,n.onload=function(){return t(new l(n,[0,0,n.width,n.height]))},n.onerror=function(t){return e(t)}})},l.prototype.fetchFromUrl=function(r){var o=this;return new Promise(function(t,e){var n=new Image;n.src=r,n.onload=function(){return t(o)},n.onerror=function(t){return e(t)}})},l);function l(t,e){var n=f.call(this)||this;return n.image=t,n.pos=e,n.render=function(t){i.putImageSource(n.image,n.pos)(t)},n.syncValue(),n}n.ImageShape=u},{"../R":2,"../planimetry":13,"./ModifyAbleShape":17}],16:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i,a=t("../R"),s=t("../planimetry"),u=t("./ModifyAbleShape"),c=(i=u.ModifyAbleShape,o(f,i),f.prototype.moveUp=function(t){this.start=[this.start[0],this.start[1]-t],this.end=[this.end[0],this.end[1]-t]},f.prototype.moveDown=function(t){this.start=[this.start[0],this.start[1]+t],this.end=[this.end[0],this.end[1]+t]},f.prototype.moveLeft=function(t){this.start=[this.start[0]-t,this.start[1]],this.end=[this.end[0]-t,this.end[1]]},f.prototype.moveRight=function(t){this.start=[this.start[0]+t,this.start[1]],this.end=[this.end[0]+t,this.end[1]]},Object.defineProperty(f.prototype,"start",{get:function(){return this.valueOf()[0]},set:function(t){var e=this.valueOf();e[0]=t,this.setValue(e)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"end",{get:function(){return this.valueOf()[1]},set:function(t){var e=this.valueOf();e[1]=t,this.setValue(e)},enumerable:!0,configurable:!0}),f.inRegion=function(t,e,n){var r=s.towPointDis(n,t),o=s.towPointDis(n,e),i=s.towPointDis(t,e);return Math.round(r+o)===Math.round(i)},f.prototype.inRegion=function(t){return f.inRegion(this.start,this.end,t)},f);function f(t,e){var n=i.call(this)||this;return n.render=function(t){a.putPath([n.start,n.end])(t)},n.setValue([t,e]),n}n.LineShape=c},{"../R":2,"../planimetry":13,"./ModifyAbleShape":17}],17:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),b=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};Object.defineProperty(n,"__esModule",{value:!0});var i,a,P=t("../editor/shapes/ControlPoint"),c=t("../planimetry"),s=t("./SelectAbleShape"),f=t("./Shape"),l=t("../R");(a=i=n.ModifyKind||(n.ModifyKind={}))[a.MoveAndModifyControlPoint=0]="MoveAndModifyControlPoint",a[a.Zoom=1]="Zoom";var u,h=(u=s.SelectAbleShape,o(p,u),p.prototype.onUnSelected=function(){this.controlPoints.forEach(function(t){return t.remove()}),this.controlPoints=[]},p.prototype.modifyValue=function(){var m=this,g=this.engine.viewPort;function t(t){var e=g.engine.ctx.canvas,n=e.offsetTop,r=e.offsetLeft,o=b([t.offsetX-r,t.offsetY-n],2),i=o[0],a=o[1],s=g.transformEvent("move",[i,a]),u=g.engine.hitTest(s.p);if(0!==u.length){S=[i,a];var c=u.map(function(t){return g.engine.getShape(t)}).filter(function(t){return t instanceof P.ControlPoint});c.length&&(_=c[0])}}function e(t){if(null!==S){var e=g.engine.ctx.canvas,n=e.offsetTop,r=e.offsetLeft,o=b([t.offsetX-r,t.offsetY-n],2),i=o[0],a=o[1];if(null===_){var s=b([S[0]-i,S[1]-a],2),u=s[0],c=s[1],f=m.valueOf().map(function(t){return[t[0]-u,t[1]-c]});m.setValue(f),m.controlPoints.forEach(function(t){return t.remove()}),m.controlPoints=P.ControlPoint.genControlPoint(m.valueOf()),g.engine.addSome(m.controlPoints),g.engine.render(!0),S=[i,a]}else{var l=b([S[0]-i,S[1]-a],2),h=l[0],p=l[1],v=b(_.rectPos,2),d=v[0],y=v[1];_.setXY(d-h,y-p);var w=m.valueOf();w[_.pathIndex]=[d-h,y-p],m.setValue(w),g.engine.render(!0),S=[i,a]}}}function n(){_=S=null}this.controlPoints=P.ControlPoint.genControlPoint(this.valueOf()),g.engine.addSome(this.controlPoints);var S=null,_=null;g.engine.ctx.canvas.addEventListener("mousedown",t),g.engine.ctx.canvas.addEventListener("mousemove",e),g.engine.ctx.canvas.addEventListener("mouseup",n),g.engine.ctx.canvas.addEventListener("mouseleave",n),this.cleanEvent=function(){n(),g.engine.ctx.canvas.removeEventListener("mousedown",t),g.engine.ctx.canvas.removeEventListener("mousemove",e),g.engine.ctx.canvas.removeEventListener("mouseup",n),g.engine.ctx.canvas.removeEventListener("mouseleave",n)},window.addEventListener("keydown",this.ZKeyDown)},p.prototype.modifyTransform=function(){var t=new f.Shape;this.controlPoints.forEach(function(t){return t.remove()});var e=b(c.getPointsRect(this.valueOf()),4),n=e[0],r=e[1],o=e[2],i=e[3],a=P.ControlPoint.createPoint(n+o,r-10,0),s=P.ControlPoint.createPoint(n-10,r+i,0),u=P.ControlPoint.createPoint(n+o+10,r+i+10,0);t.setValue([[n+o,r-10],[n-10,r-10],[n-10,r+i]]),t.render=function(t){return l.putPath(this.valueOf(),!1)(t)},this.engine.addSome([t,a,s,u]),this.engine.render(!0),console.log("modifyTransform")},p.prototype.onSelected=function(t,e){this.kind===i.MoveAndModifyControlPoint?this.modifyValue():this.kind===i.Zoom&&this.modifyTransform()},p.prototype.unSelect=function(){this.controlPoints.forEach(function(t){return t.remove()}),this.controlPoints=[],this.drawState={strokeStyle:"#000"},u.prototype.unSelect.call(this),window.removeEventListener("keydown",this.ZKeyDown)},p);function p(){var e=null!==u&&u.apply(this,arguments)||this;return e.controlPoints=[],e.kind=i.MoveAndModifyControlPoint,e.cleanEvent=function(){},e.ZKeyDown=function(t){90===t.keyCode&&(e.cleanEvent(),e.engine.render(!0),e.kind===i.MoveAndModifyControlPoint?(e.kind=i.Zoom,e.modifyTransform()):(e.kind=i.MoveAndModifyControlPoint,e.modifyValue()))},e}n.ModifyAbleShape=h},{"../R":2,"../editor/shapes/ControlPoint":5,"../planimetry":13,"./SelectAbleShape":21,"./Shape":22}],18:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i,a=t("../R"),s=t("../utils"),u=t("./LineShape"),c=t("./ModifyAbleShape"),f=(i=c.ModifyAbleShape,o(l,i),l.prototype.moveUp=function(e){this.paths=this.paths.map(function(t){return[t[0],t[1]+e]})},l.prototype.moveDown=function(e){this.paths=this.paths.map(function(t){return[t[0],t[1]-e]})},l.prototype.moveLeft=function(e){this.paths=this.paths.map(function(t){return[t[0]+e,t[1]]})},l.prototype.moveRight=function(e){this.paths=this.paths.map(function(t){return[t[0]-e,t[1]]})},Object.defineProperty(l.prototype,"paths",{get:function(){return this.valueOf()},set:function(t){this.setValue(t)},enumerable:!0,configurable:!0}),l.prototype.inRegion=function(e){return s.sliding(2,this.paths).some(function(t){return u.LineShape.inRegion(t[0],t[1],e)})},l);function l(t){var e=i.call(this)||this;return e.render=function(t){a.putPath(e.paths)(t)},e.setValue(t),e}n.PathShape=f},{"../R":2,"../utils":24,"./LineShape":16,"./ModifyAbleShape":17}],19:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i,a=t("./PathShape"),s=t("../R"),u=t("../planimetry"),c=(i=a.PathShape,o(f,i),f.prototype.inRegion=function(t){return u.isInPolygon(this.paths,t)},f);function f(){var e=null!==i&&i.apply(this,arguments)||this;return e.isFilled=!1,e.render=function(t){s.putPath(e.paths,!0)(t),e.isFilled&&t.fill()},e}n.PloygonShape=c},{"../R":2,"../planimetry":13,"./PathShape":18}],20:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};Object.defineProperty(n,"__esModule",{value:!0});var c,f=t("../R"),i=t("./ModifyAbleShape"),a=(c=i.ModifyAbleShape,o(s,c),s);function s(t,e){void 0===e&&(e=!0);var n=c.call(this)||this;n.filled=e,n.render=function(t){f.putPath(n.valueOf(),!0)(t)};var r=u(t,4),o=r[0],i=r[1],a=r[2],s=r[3];return c.prototype.setValue.call(n,[[o,i],[o+a,i],[o+a,i+s],[o,i+s]]),n}n.RectShape=a},{"../R":2,"./ModifyAbleShape":17}],21:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),l=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};Object.defineProperty(n,"__esModule",{value:!0});var i,a=t("./Shape"),s=(i=a.Shape,o(u,i),u.prototype.onMouseDown=function(u){var c=this;if(!this.isSelected()){this.select(),this.drawState={strokeStyle:"red"};var f=u.viewport.clone();f.engine.ctx.canvas.addEventListener("mousedown",function(t){var e=u.viewport.engine.ctx.canvas,n=e.offsetTop,r=e.offsetLeft,o=l([t.offsetX-r,t.offsetY-n],2),i=o[0],a=o[1],s=f.transformEvent("move",[i,a]);0===f.engine.hitTest(s.p).length&&(c.drawState={strokeStyle:"#000",fillStyle:"#000"},u.viewport.engine.add(c),u.viewport.engine.render(!0),f.engine.ctx.canvas.remove(),c.unSelect())}),this.remove(),u.viewport.engine.clearAll(),u.viewport.engine.render(),f.engine.add(this),this.onSelected(f,u),f.engine.render(),u.viewport.appendViewPort(f),u.viewport.engine.render(!0)}return!1},u.prototype.unSelect=function(){this.drawState={strokeStyle:"#000"},this.onUnSelected(),i.prototype.unSelect.call(this)},u);function u(){return null!==i&&i.apply(this,arguments)||this}n.SelectAbleShape=s},{"./Shape":22}],22:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};Object.defineProperty(n,"__esModule",{value:!0});var i,a=t("../planimetry"),s=t("../handler/DefaultMouseEvent"),u=(i=s.DefaultMouseEvent,o(f,i),f.prototype.isSelected=function(){return this.selected},f.prototype.select=function(){this.selected=!0},f.prototype.unSelect=function(){this.selected=!1},f.prototype.setEngine=function(t){this.engine=t},f.prototype.remove=function(){this.engine&&this.engine.remove(this)},f.prototype.inRegion=function(t){return a.isInPolygon(this.valueOf(),t)},f.prototype.inRegionAndSetEnterState=function(t){var e=this.inRegion(t);return e?this.isEnter||(this.isEnter=!0,this.isLeave=!1):this.isEnter&&(this.isEnter=!1,this.isLeave=!0),e},f.prototype.moveUp=function(e){this.setValue(this.valueOf().map(function(t){return[t[0],t[1]+e]}))},f.prototype.moveDown=function(e){this.setValue(this.valueOf().map(function(t){return[t[0],t[1]-e]}))},f.prototype.moveLeft=function(e){this.setValue(this.valueOf().map(function(t){return[t[0]+e,t[1]]}))},f.prototype.moveRight=function(e){this.setValue(this.valueOf().map(function(t){return[t[0]-e,t[1]]}))},f.prototype.setValue=function(t){this.value=t},f.prototype.valueOf=function(){return a.copyPath(this.value)},f.autoIndex=0,f);function f(){var u=i.call(this)||this;return u.isEnter=!1,u.isLeave=!1,u.visable=!0,u.engine=null,u.drawState=null,u.selected=!1,u.transformMatrix=a.createTransformMatrix(),u.renderAfterState=function(t){var e=c(u.transformMatrix,6),n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5];t.setTransform(n,i,r,a,o,s),u.drawState?(t.save(),u.drawState.direction&&(t.direction=u.drawState.direction),u.drawState.font&&(t.font=u.drawState.font),u.drawState.textAlign&&(t.textAlign=u.drawState.textAlign),u.drawState.textBaseline&&(t.textBaseline=u.drawState.textBaseline),u.drawState.fillStyle&&(t.fillStyle=u.drawState.fillStyle),u.drawState.strokeStyle&&(t.strokeStyle=u.drawState.strokeStyle),u.drawState.filter&&(t.filter=u.drawState.filter),u.drawState.globalAlpha&&(t.globalAlpha=u.drawState.globalAlpha),u.drawState.globalCompositeOperation&&(t.globalCompositeOperation=u.drawState.globalCompositeOperation),u.drawState.imageSmoothingEnabled&&(t.imageSmoothingEnabled=u.drawState.imageSmoothingEnabled),u.drawState.imageSmoothingQuality&&(t.imageSmoothingQuality=u.drawState.imageSmoothingQuality),u.drawState.lineCap&&(t.lineCap=u.drawState.lineCap),u.drawState.lineDashOffset&&(t.lineDashOffset=u.drawState.lineDashOffset),u.drawState.lineJoin&&(t.lineJoin=u.drawState.lineJoin),u.drawState.lineWidth&&(t.lineWidth=u.drawState.lineWidth),u.drawState.miterLimit&&(t.miterLimit=u.drawState.miterLimit),u.drawState.shadowBlur&&(t.shadowBlur=u.drawState.shadowBlur),u.drawState.shadowColor&&(t.shadowColor=u.drawState.shadowColor),u.drawState.shadowOffsetX&&(t.shadowOffsetX=u.drawState.shadowOffsetX),u.drawState.shadowOffsetY&&(t.shadowOffsetY=u.drawState.shadowOffsetY),u.render(t),t.restore()):u.render(t)},u.render=function(){},u.value=[],u.zindex=f.autoIndex++,u}n.Shape=u},{"../handler/DefaultMouseEvent":9,"../planimetry":13}],23:[function(t,e,n){"use strict";function r(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0}),r(t("./Shape")),r(t("./PloygonShape")),r(t("./PathShape")),r(t("./LineShape")),r(t("./ImageShape")),r(t("./CircleShape")),r(t("./RectShape"))},{"./CircleShape":14,"./ImageShape":15,"./LineShape":16,"./PathShape":18,"./PloygonShape":19,"./RectShape":20,"./Shape":22}],24:[function(t,e,r){"use strict";var c=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},f=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function n(t,e){for(var n=[],r=0;r<t.length;r++)n.push(t[r]+e[r]);return n}function o(t,e){for(var n=[],r=[],o=0;o<e.length;o++)r.push(e[o]),(o+1)%t==0&&(n.push(r),r=[]);return 0!==r.length&&n.push(r),n}function i(t,e,n){return t+e*n}function a(e){return function(t){return e===t}}Object.defineProperty(r,"__esModule",{value:!0}),r.cacheLast=function(e){var n=null,r=[];return function(t){return n&&n===t?r:r=e(n=t)}},r.range=function(t){if(t===1/0)throw new Error("too large");for(var e=[],n=0;n<t;n++)e.push(n);return e},r.crange=r.cacheLast(r.range),r.map=function(t,e){return e.map(t)},r.colorChannel=function(t){var e=t.data;return[r.map(function(t){return e[4*t]},r.crange(e.length/4)),r.map(function(t){return e[4*t+1]},r.crange(e.length/4)),r.map(function(t){return e[4*t+2]},r.crange(e.length/4)),r.map(function(t){return e[4*t+3]},r.crange(e.length/4))]},r.addArray=n,r.addArrays=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce(function(t,e){return n(t,e)})},r.copyArrayElements=function(t,e){var n,r,o=[];try{for(var i=c(e),a=i.next();!a.done;a=i.next())for(var s=a.value,u=0;u<t;u++)o.push(s)}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o},r.chunk=o,r.sliding=function(t,e){if(t<=0)return[e];for(var n=[],r=0;r<e.length;r+=t){if(!(r+t<e.length)){n.push(e.slice(r,e.length-1));break}n.push(e.slice(r,r+t))}return n},r.mergeColorChannel=function(t,e){for(var n=f(t,4),r=n[0],o=n[1],i=n[2],a=n[3],s=[],u=0;u<r.length;u++)[r[u],o[u],i[u],a[u]].forEach(function(t){return s.push(Math.floor(t))});return new ImageData(new Uint8ClampedArray(s),e,r.length/e)},r.pos2index=i,r.index2pos=function(t,e){return[t%e,Math.floor(t/e)]},r.rowIndex=function(t,e){return o(t,r.crange(t*e))},r.colIndex=function(n,t){return r.map(function(e){return r.map(function(t){return i(e,t,n)},r.crange(t))},r.crange(n))},r.countArray=function(t){var e,n,r=new Map;try{for(var o=c(t),i=o.next();!i.done;i=o.next()){var a=i.value;r.has(a)?r.set(a,r.get(a)+1):r.set(a,1)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r},r.isEq=a,r.eqT=a(!0),r.createCanvasContext2d=function(t,e){void 0===t&&(t=100),void 0===e&&(e=100);var n=document.createElement("canvas");n.width=t,n.height=e;var r=n.getContext("2d");if(null===r)throw new Error("cont create canvas ctx !");return r},r.zip=function(t){for(var e=[],n=0;n<t[0].length;n++){for(var r=[],o=0;o<t.length;o++)r.push(t[o][n]);e.push(r)}return e}},{}],25:[function(t,e,n){"use strict";var c=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};Object.defineProperty(n,"__esModule",{value:!0});var r=t("./planimetry"),f=t("./handler/MouseEventHandler"),l=t("./Engine"),o=t("./utils"),i=(a.prototype.trigger=function(t,e){var n=this.transformEvent(e,t);this.engine.trigger(n)},a.prototype.clone=function(){return new a({width:this.width,height:this.height,transformMatrix:this.transformMatrix,ctx:o.createCanvasContext2d()})},a.prototype.cloneAndCopyAShape=function(t){var e=this.clone();return e.engine.add(t),e},a.prototype.cloneAndCopyAShapeByIndex=function(t){var e=this.engine.getShape(t);return this.cloneAndCopyAShape(e)},a.prototype.transformEvent=function(t,e){return{p:r.transform(this.transformMatrix,e),action:t,viewport:this}},a);function a(t){var e=this;this.mouseEventHandler=new f.MouseEventHandler(this),this.viewports=[],this.appendViewPort=function(t){e.viewports.push(t)},this.removeAllViewPort=function(){e.viewports=[]},this.ctx=t.ctx,this.width=t.width,this.height=t.height,this.transformMatrix=t.transformMatrix,this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height;var n=c(this.transformMatrix,6),r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],u=n[5];this.ctx.setTransform(r,a,o,s,i,u),this.engine=new l.Engine(this.ctx,this),this.mouseEventHandler.bind()}n.ViewPort=i},{"./Engine":1,"./handler/MouseEventHandler":10,"./planimetry":13,"./utils":24}]},{},[12])(12)});
//# sourceMappingURL=letter.min.js.map
